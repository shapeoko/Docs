<!doctype html>
<html>
    <head>
      <title>Project Shapeoko</title>

      <!--include styles-->
      <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,400,700' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
      <link href="css/shapeoko.css" rel="stylesheet" />

      <!--include javascript-->
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
      <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
      <script src="js/markdown.js"></script>

      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-11630357-11']);
        _gaq.push(['_setDomainName', 'shapeoko.com']);
        _gaq.push(['_trackPageview']);

        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
    </head>
    <body>
        <script>
          $(document).ready(function(){
            var recordHistory = function(pageName) {
              window.history.pushState({markdown: pageName}, '', '#' + pageName);
            }

            var markdownNameToUrl = function(name) {
              return "content/" + name + ".md";
            };

            var markdownFromUrl = function(url) {
              return url.replace('#', '');
            }

            var loadMarkdown = function(name, shouldRecord) {
              $.ajax({
                url: markdownNameToUrl(name),
                dataType: "text",
                success: function(response){
                  if (shouldRecord) {
                    recordHistory(name);
                  }
                  $("#content").html('').append(markdown.toHTML(response));
                }
              });
            };

            $("body").load("navigation.html", function() {
              $(this).on("click", "#side-nav a", function(e) {
                e.preventDefault();

                loadMarkdown($(this).data('markdown'), true);

                return false;
              });
            });

            var currentState = 'index';

            if (window.location.hash !== '') {
              currentState = markdownFromUrl(window.location.hash);
            }

            loadMarkdown(currentState);

            $(window).bind('popstate', function (event) {
              var state = event.originalEvent.state;
              if (state !== undefined) {
                if (state === null) {
                  loadMarkdown(markdownFromUrl(window.location.hash));
                } else if (state.markdown) {
                  loadMarkdown(event.originalEvent.state.markdown);
                } else {
                  console.log("Got popstate, don't know what to do")
                  console.log(event.originalEvent)
                }
              }
            });
          });
        </script>

    </body>
</html>
